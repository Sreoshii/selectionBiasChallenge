---
title: "Selection Bias & Missing Data Challenge"
subtitle: "Creating a Statistics Meme: Write Your Own Functions"
format:
  html: default
execute:
  echo: false
  eval: true
---

# ðŸŽ¨ Selection Bias & Missing Data Challenge

## Final Statistics Meme

```{python}
#| label: step1-prepare
#| echo: false
#| fig-show: false
#| output: false

import sys
from io import StringIO

# Suppress print output
old_stdout = sys.stdout
sys.stdout = StringIO()

import numpy as np
import matplotlib.pyplot as plt
from step1_prepare_image import prepare_image

# Load and prepare the image
img_path = 'My_Image.jpg'
gray_image = prepare_image(img_path, max_size=512)

# Restore stdout
sys.stdout = old_stdout
```

```{python}
#| label: step2-stipple
#| echo: false
#| fig-show: false
#| message: false
#| warning: false
#| output: false

import sys
from io import StringIO

# Suppress print output
old_stdout = sys.stdout
sys.stdout = StringIO()

from step2_create_stipple import create_stipple

# Create stippled image
stipple_pattern, samples = create_stipple(
    gray_image,
    percentage=0.08,
    sigma=0.9,
    content_bias=0.9,
    noise_scale_factor=0.1,
    extreme_downweight=0.5,
    extreme_threshold_low=0.2,
    extreme_threshold_high=0.8,
    extreme_sigma=0.1
)

# Restore stdout
sys.stdout = old_stdout
```

```{python}
#| label: step4-block-letter
#| echo: false
#| fig-show: false
#| output: false

import sys
from io import StringIO

# Suppress print output
old_stdout = sys.stdout
sys.stdout = StringIO()

from step4_create_block_letter import create_block_letter_s

# Get image dimensions
h, w = gray_image.shape

# Create block letter S
block_letter = create_block_letter_s(h, w, letter="S", font_size_ratio=0.9)

# Restore stdout
sys.stdout = old_stdout
```

```{python}
#| label: step5-masked
#| echo: false
#| fig-show: false
#| output: false

import sys
from io import StringIO

# Suppress print output
old_stdout = sys.stdout
sys.stdout = StringIO()

from step5_create_masked import create_masked_stipple

# Create masked stippled image
masked_stipple = create_masked_stipple(
    stipple_pattern,
    block_letter,
    threshold=0.5
)

# Restore stdout
sys.stdout = old_stdout
```

```{python}
#| label: create-final-meme
#| echo: false
#| fig-show: false
#| output: false

import sys
from io import StringIO

# Suppress print output
old_stdout = sys.stdout
sys.stdout = StringIO()

from create_meme import create_statistics_meme

# Create the final meme
create_statistics_meme(
    original_img=gray_image,
    stipple_img=stipple_pattern,
    block_letter_img=block_letter,
    masked_stipple_img=masked_stipple,
    output_path="my_statistics_meme.png",
    dpi=150,
    background_color="white"
)

# Restore stdout
sys.stdout = old_stdout
```

```{python}
#| label: final-meme
#| echo: false
#| fig-cap: "Statistics meme demonstrating selection bias"

import matplotlib.pyplot as plt
import matplotlib.image as mpimg

# Load and display the meme
meme_img = mpimg.imread("my_statistics_meme.png")
fig, ax = plt.subplots(figsize=(10, 2.5))
ax.imshow(meme_img)
ax.axis('off')
plt.tight_layout(pad=0.1)
plt.show()
```

## Explanation

The four panels illustrate how selection bias systematically distorts statistical estimates. The first panel (Reality) shows the complete, unbiased truthâ€”the full population we wish to understand. The second panel (Your Model) represents our sampled data through stippling, where each dot is an observation. While this sampling captures the overall structure, the third panel reveals the problem: selection bias creates a systematic pattern of missing data (the "S" shape), not random gaps. The final panel (Estimate) shows the devastating consequenceâ€”when we analyze only the remaining data points, we get a distorted view that no longer reflects reality. This visual metaphor demonstrates why systematic missing data is so dangerous: it doesn't just reduce sample size, it fundamentally changes what we can learn from our data, leading to conclusions that may be completely wrong despite appearing to be based on valid observations.
